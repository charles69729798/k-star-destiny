# 시스템 업데이트 및 연결 문제 근본 원인 분석 보고 (2차)

## 1. 과거 조치 사항 분석 (복기)
과거에도 `node.exe` 프로세스 충돌 문제가 보고되어 다음 조치가 시행된 바 있습니다:
- **주요 조치**: `taskkill`을 통한 프로세스 강제 종료 및 서버 재시작.
- **결과**: 일시적으로 해결되었으나, 특정 환경(Vite 내부 캐시 정체 등)에서 동일 현상이 재발함.

## 2. 과거 조치 vs 현재 조치의 차이점

| 구분 | 과거 조치 (1차) | 현재 조치 (2차 - 개선안) | 개선 목적 |
| :--- | :--- | :--- | :--- |
| **프로세스 관리** | 단순 `taskkill` 실행 | `taskkill` + 포트 점유 상태 (`netstat`) 정밀 확인 | 유령 프로세스의 완전한 박멸 확인 |
| **캐시 제어** | 브라우저 새로고침 안내 | **Vite 서버 내부 캐시(`.vite`폴더) 강제 삭제** | 소스 코드 변경 사항의 서버 레벨 반영 보장 |
| **워치 모드** | 기본 설정 사용 | **Vite Polling 워치 설정 (`usePolling: true`)** | 윈도우 파일 시스템 특성에 따른 변경 감지 누락 방지 |
| **코드 구조** | 기존 UI 유지 (속성만 변경) | **UI 구조 전면 개편 (Input → Div/Button)** | 브라우저가 이전 돔(DOM) 정보를 기억하지 못하게 강제 갱신 |

## 3. 왜 문제가 반복되었나?
1. **Vite의 강력한 최적화 캐시**: Vite는 빌드 속도를 위해 `.vite` 폴더에 사전 번들링된 캐시를 저장하는데, 소스 코드가 바뀌어도 이 캐시가 깨지지 않으면 브라우저에 옛날 파일을 계속 던져줍니다.
2. **윈도우 파일 시스템의 한계**: 네트워크 드라이브나 특정 보안 설정 환경에서는 Vite가 파일이 바뀌었다는 신호를 놓치는 경우가 있습니다. 이를 방지하기 위해 Polling 방식을 도입했습니다.
3. **가디언 스크립트와의 충돌**: 백그라운드에서 실행되는 `kdestiny_guardian.ps1`이 비정상 종료된 서버를 다시 띄울 때, 캐시를 지우지 않고 띄워 구버전이 노출되었을 가능성이 있습니다.

## 4. 향후 재발 방지 대책
- **자동화된 배포 스크립트 고도화**: 단순 재시작이 아닌 `캐시 삭제 -> 포트 체크 -> 서버 시작` 순서가 보장되는 스크립트를 통합 관리합니다.
- **강제 캐시 무효화 전략**: 주요 UI 변경 시 스타일 클래스나 키(Key) 값을 변경하여 브라우저가 새 파일임을 즉시 인지하도록 합니다.
